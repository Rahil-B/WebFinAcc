@model OnlineAccounting.Models.Sales.SalesOrder

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Create</h1>

<h4>SalesOrder</h4>
<hr />
<div class="row">
    <div class="col-md-6">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="CustomerId" class="control-label"></label>
                <select asp-for="CustomerId" class="form-control" asp-items="ViewBag.CustomerId"></select>
                <span asp-validation-for="CustomerId" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="SalesOrderNumber" class="control-label"></label>
                <input asp-for="SalesOrderNumber" class="form-control" />
                <span asp-validation-for="SalesOrderNumber" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Date" class="control-label"></label>
                <input asp-for="Date" class="form-control" />
                <span asp-validation-for="Date" class="text-danger"></span>
            </div>

            <hr />
            <br /> 
            <div class="sales-order-item-list">
                <div class="row">
                    <div class="form-group col">
                        <label asp-for="ItemList[0].ItemId" class="control-label"></label>
                        <select asp-for="ItemList[0].ItemId" class="form-control" asp-items="ViewBag.ItemId">
                            <option value="">Select</option>
                            <option value="1">Sand</option>
                            <option value="2">Cement</option>
                        </select>
                        <span asp-validation-for="ItemList[0].ItemId" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[0].Quantity" class="control-label"></label>
                        <input asp-for="ItemList[0].Quantity" class="form-control" />
                        <span asp-validation-for="ItemList[0].Quantity" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[0].Rate" class="control-label"></label>
                        <input asp-for="ItemList[0].Rate" class="form-control" />
                        <span asp-validation-for="ItemList[0].Rate" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[0].Discount" class="control-label"></label>
                        <input asp-for="ItemList[0].Discount" class="form-control" />
                        <span asp-validation-for="ItemList[0].Discount" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[0].Tax" class="control-label"></label>
                        <input asp-for="ItemList[0].Tax" class="form-control" />
                        <span asp-validation-for="ItemList[0].Tax" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[0].Amount" class="control-label"></label>
                        <input asp-for="ItemList[0].Amount" class="form-control" />
                        <span asp-validation-for="ItemList[0].Amount" class="text-danger"></span>
                    </div>
                </div>

                    @for (var i = 1; i < ViewBag.itemCount; i++)
                    {
                <div class="row">
                    <div class="form-group col">
                        <label asp-for="ItemList[i].ItemId" class="control-label"></label>
                        <select asp-for="ItemList[i].ItemId" class="form-control" asp-items="ViewBag.ItemId">
                            <option value="">Select</option>
                            <option value="1">Sand</option>
                            <option value="2">Cement</option>
                        </select>
                        <span asp-validation-for="ItemList[i].ItemId" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[i].Quantity" class="control-label"></label>
                        <input asp-for="ItemList[i].Quantity" class="form-control" />
                        <span asp-validation-for="ItemList[i].Quantity" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[i].Rate" class="control-label"></label>
                        <input asp-for="ItemList[i].Rate" class="form-control" />
                        <span asp-validation-for="ItemList[i].Rate" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[i].Discount" class="control-label"></label>
                        <input asp-for="ItemList[i].Discount" class="form-control" />
                        <span asp-validation-for="ItemList[i].Discount" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[i].Tax" class="control-label"></label>
                        <input asp-for="ItemList[i].Tax" class="form-control" />
                        <span asp-validation-for="ItemList[i].Tax" class="text-danger"></span>
                    </div>
                    <div class="form-group col">
                        <label asp-for="ItemList[i].Amount" class="control-label"></label>
                        <input asp-for="ItemList[i].Amount" class="form-control" />
                        <span asp-validation-for="ItemList[i].Amount" class="text-danger"></span>
                    </div>
                </div>
                    }

            </div>
            <div class="form-group">
                <input class="btn btn-primary" type="button" value="Add More" id="AddOrderItem" />
            </div>
            <br /> 
            <hr />

            <div class="form-group">
                <label asp-for="ShippingCharges" class="control-label"></label>
                <input asp-for="ShippingCharges" class="form-control" />
                <span asp-validation-for="ShippingCharges" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ChargeAdjustment" class="control-label"></label>
                <input asp-for="ChargeAdjustment" class="form-control" />
                <span asp-validation-for="ChargeAdjustment" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Total" class="control-label"></label>
                <input asp-for="Total" class="form-control" />
                <span asp-validation-for="Total" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="TotalItems" class="control-label"></label>
                <input asp-for="TotalItems" class="form-control" />
                <span asp-validation-for="TotalItems" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>



<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript">
        //var ItemIdOptions = []
        function RemoveOrderItem(button) {
            $(button).parent().parent().remove();
        }
        
        $(document).ready(function () {
            /*
            $("#ItemList_0__ItemId option").each(function () {
                var tempOpt = $("<option/>").text(this.text).val(this.val)
                ItemIdOptions.push(tempOpt)
            });
            */
            var ItemCount = 1;
            /* ItemId Quantity Rate Discount Tax Amount*/
            $("#AddOrderItem").click(function () {
                console.log("adding Item Row")
                /*
                var div = $("<div class='row'/>");
                var value = "";
                var itemId = $("<input />").attr("type", "textbox").attr("name", "ItemList[" + ItemCount + "].ItemId");
                itemId.val(value);
                var quantity = $("<input />").attr("type", "textbox").attr("name", "ItemList[" + ItemCount + "].Quantity");
                quantity.val(value)
                var rate = $("<input />").attr("type", "textbox").attr("name", "ItemList[" + ItemCount + "].Rate");
                rate.val(value)
                var discount = $("<input />").attr("type", "textbox").attr("name", "ItemList[" + ItemCount + "].Discount");
                discount.val(value)
                var tax = $("<input />").attr("type", "textbox").attr("name", "ItemList[" + ItemCount + "].Tax");
                tax.val(value)
                var amount = $("<input />").attr("type", "textbox").attr("name", "ItemList[" + ItemCount + "].Amount");
                amount.val(value)
                div.append(itemId)
                div.append(quantity)
                div.append(rate)
                div.append(discount)
                div.append(tax)
                div.append(amount)
                var button = $("<input />").attr("type", "button").attr("value", "Remove");
                button.attr("onclick", "RemoveOrderItem(this)");
                div.append(button)
                $(".sales-order-item-list").append(div);
                */

                var htmlForRow = `<div class="row">
                    <div class= "form-group col">
                        <label class="control-label" for="ItemList_0__ItemId">ItemId</label>
                        <select class="form-control" data-val="true" data-val-required="The ItemId field is required." id="ItemList_0__ItemId" name="ItemList[0].ItemId"></select>
                        <span class="text-danger field-validation-valid" data-valmsg-for="ItemList[0].ItemId" data-valmsg-replace="true"></span>
                    </div >
                    <div class="form-group col">
                        <label class="control-label" for="ItemList_0__Quantity">Quantity</label>
                        <input class="form-control" type="number" data-val="true" data-val-required="The Quantity field is required." id="ItemList_0__Quantity" name="ItemList[0].Quantity" value="">
                            <span class="text-danger field-validation-valid" data-valmsg-for="ItemList[0].Quantity" data-valmsg-replace="true"></span>
                    </div>
                        <div class="form-group col">
                            <label class="control-label" for="ItemList_0__Rate">Rate</label>
                            <input class="form-control" type="text" data-val="true" data-val-number="The field Rate must be a number." data-val-required="The Rate field is required." id="ItemList_0__Rate" name="ItemList[0].Rate" value="">
                                <span class="text-danger field-validation-valid" data-valmsg-for="ItemList[0].Rate" data-valmsg-replace="true"></span>
                    </div>
                            <div class="form-group col">
                                <label class="control-label" for="ItemList_0__Discount">Discount</label>
                                <input class="form-control" type="text" data-val="true" data-val-number="The field Discount must be a number." data-val-required="The Discount field is required." id="ItemList_0__Discount" name="ItemList[0].Discount" value="">
                                    <span class="text-danger field-validation-valid" data-valmsg-for="ItemList[0].Discount" data-valmsg-replace="true"></span>
                    </div>
                                <div class="form-group col">
                                    <label class="control-label" for="ItemList_0__Tax">Tax</label>
                                    <input class="form-control" type="text" data-val="true" data-val-number="The field Tax must be a number." data-val-required="The Tax field is required." id="ItemList_0__Tax" name="ItemList[0].Tax" value="">
                                        <span class="text-danger field-validation-valid" data-valmsg-for="ItemList[0].Tax" data-valmsg-replace="true"></span>
                    </div>
                                    <div class="form-group col">
                                        <label class="control-label" for="ItemList_0__Amount">Amount</label>
                                        <input class="form-control" type="text" data-val="true" data-val-number="The field Amount must be a number." data-val-required="The Amount field is required." id="ItemList_0__Amount" name="ItemList[0].Amount" value="">
                                            <span class="text-danger field-validation-valid" data-valmsg-for="ItemList[0].Amount" data-valmsg-replace="true"></span>
                    </div>
                                    <div class="form-group col">
                                        <input class="form-control" type="button" value="X" onclick="RemoveOrderItem(this)">
                    </div>
                          </div>`.replaceAll('0', ItemCount);
                //console.log($("select").html)
                //console.log(htmlForRow);
                var row = $(htmlForRow)

                $(".sales-order-item-list").append(row);
                //$("#ItemList_" + ItemCount + "__ItemId").html(ItemIdOptions.join(" "))
                $("#ItemList_0__ItemId option").each(function () {
                    var tempOpt = $("<option/>").text(this.text).val(this.val)
                    //ItemIdOptions.push(tempOpt)
                    $("#ItemList_" + ItemCount + "__ItemId").append(new Option(this.text, this.value))
                });
                //console.log($("select"))
                ItemCount++;
                
            })

        })
    </script>
}
